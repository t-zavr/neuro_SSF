Этот репозиторий содержит код, необходимый для реализации проекта 
"Нейросетевой подход к решению двумерной задачи обтекания
препятствия произвольной формы".

Работа выполняется в несколько этапов:
1. Сборка и расчет кейсов - решения множества задач гидродинамики для произвольных тел.
2. Сбор данных из решенных кейсов и их подготовка для обучения.
3. Обучение нейронной сети и проверка результатов.

# Ремарка.
В каждом скрипте нужно указывать (если требуется) необходимые пути и кол-во выделенных потоков.
Предполагается использование на Linux, либо редактура кода под Windows.

# Сборка и расчет кейсов.
Код для этого шага содержится в директории code_computing.
Расчет осуществляется с помощью пакета openFoam8, либо редактирование кода под openFoam других версий.
Произвольное тело и область, в которой оно находится, содержится в черно-белом изображении 128*256 формата png.

Скрипт resizer - на случай, если ваши изображения имеют формат 128*128, этой утилитой
можно увеличить их до 256*128 (помещает исходную картинку на больший белый фон).

1. main - создает mesh-сетку из изображений и собирает кейс по шаблону кейса cavity.
В нем требуется указать путь к png-файлам и папку, где будут сохранены кейсы.
2. fix_boundary - корректирует несколько строк в файлах кейса.
3. block_mesh_all - запускает генерацию mesh-сетки во всех кейсах. 
Возможно, будет необходим запуск из командной строки.
4. run_all - запускает расчет кейсов (это долгая процедура).
Возможно, будет необходим запуск из командной строки.



# Сбор данных из решенных кейсов.
Код для этого этапа находится в директории code_postProd.

1. write_center - записывает в последнем "моменте времени" каждого кейса центры ячеек.
2. cp_data - собирает файлы 'U', 'C' и 'p' из кейсов и сортирует в dest_dir
Также сохраняет в dest_dir файл со списком пропущенных (по любой причине) кейсов.
3. refactor - восстанавливает из данных формы тел и векторы скорости, сохраняет их в папки bnd_set и flow_set, соответственно.
bnd_set (boundary_set) - это текстовые файлы из нулей и единиц (наличие или отсутствие в данной точке объекта);
flow_set - текстовые файлы из двух больших столбцов с векторами скорости X и Y в данной точке.
Многопоточность осуществляется с помощью скрипта ref_def.
4. normalize - нормирует величины векторов скорости от -1 до 1 по всему набору данных.
После него, нормированы будут также точки, в которых расположен объект (хотя они должны остаться нулями),
это исправляется в следующем скрипте.
5. upscale - повышает разрешение изображений до 256*128, исправляет проблему с нулями,
создает в изображениях рамки по бокам (границы вдоль области).

# Обучение нейронной сети.
Код для этого (и следующего тоже) этапа находится в директории code_toLearn.

1. packing - создает файл формата tfrecords с данными для обучения и тестирования.
2. flow_train - запускает обучение нейросети.
Скрипт ссылается на другие скрипты в папке model.

prediction - генерирует одно изображение (flow_generated), используя чекпойнт обученной сети.
accuracy - собирает статистику по ошибкам сети на основе множества данных (flow_true).
